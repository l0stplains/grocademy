{
  email admin@grocademy.store
  # while testing first time to avoid rate limits:
  # acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
}

grocademy.store {
  encode zstd gzip

  @static {
    path *.css *.js *.svg *.png *.jpg *.jpeg *.gif *.ico *.woff *.woff2
  }
  header @static Cache-Control "public, max-age=604800"

  # pass everything to the app container
  reverse_proxy app:3000 {
    header_up Host {host}
    header_up X-Real-IP {remote_host}
    header_up X-Forwarded-For {remote}
    header_up X-Forwarded-Proto {scheme}
    transport http {
      # long-poll friendly timeouts
      read_timeout 2m
      write_timeout 2m
      dial_timeout 10s
      keepalive 60s
    }
  }
}
