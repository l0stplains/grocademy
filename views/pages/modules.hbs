{{> head title=title description=description canonical=canonical bodyAttrs=(concat 'data-poll-modules="1"
data-course-id="' courseId '" data-selected-id="' (or (and selected selected.id) '') '"')}}
{{> navbar user=user}}

<main class="container">
  <div class="layout">
    <aside class="sidebar">
      <h2>Course modules</h2>
      <div class="hr"></div>
      <div id="modules-list" class="grid" style="gap:10px">
        {{#each modules}}
        <a class="module-item {{#if this.is_completed}}done{{/if}} {{#if (eq this.id ../selected.id)}}active{{/if}}"
          href="/courses/{{../courseId}}/modules?m={{this.id}}">
          <span class="dot"></span>
          <div>
            <strong>#{{this.order}} — {{this.title}}</strong>
            <small>{{this.description}}</small>
          </div>
        </a>
        {{/each}}
      </div>
    </aside>

    <section id="module-content" class="content">
      {{#if selected}}
      <div class="space-between">
        <h1>#{{selected.order}} — {{selected.title}}</h1>
        <span id="module-done-badge"
          class="badge owned {{#unless selected.is_completed}}hidden{{/unless}}">Completed</span>
      </div>
      <p class="muted">{{selected.description}}</p>

      {{#if selected.pdf_content}}
      <div class="media-frame media-frame--pdf" style="margin:12px 0">
        <iframe src="{{selected.pdf_content}}#view=FitH&zoom=page-width" title="Module PDF" loading="lazy"
          referrerpolicy="no-referrer"></iframe>
      </div>
      <div class="row">
        <a class="btn" href="{{selected.pdf_content}}" target="_blank" rel="noopener">Open PDF in new tab</a>
        <a class="btn ghost" href="{{selected.pdf_content}}" download>Download</a>
      </div>
      {{/if}}

      {{#if selected.video_content}}
      <div class="media-frame media-frame--video" style="margin:12px 0">
        <video controls playsinline preload="metadata" controlsList="nodownload noplaybackrate">
          <source src="{{selected.video_content}}">
        </video>
      </div>
      <div class="row">
        <a class="btn" href="{{selected.video_content}}" target="_blank" rel="noopener">Open video in new tab</a>
      </div>
      {{/if}}

      {{#unless selected.is_completed}}
      <form id="complete-module-form" method="post" action="/modules/{{selected.id}}/complete?courseId={{../courseId}}"
        data-module-id="{{selected.id}}">
        <button class="btn primary" type="submit">Mark as completed</button>
      </form>
      {{/unless}}

      <div class="hr"></div>
      <div aria-label="Course progress" class="progress">
        <div id="course-progress" style="width: 0%"></div>
      </div>
      <a id="certificate-link" class="btn hidden" href="#" target="_blank" rel="noopener">Download Certificate</a>
      {{else}}
      <div class="alert">No module selected.</div>
      {{/if}}
    </section>
  </div>
</main>
{{> footer year="2025"}}